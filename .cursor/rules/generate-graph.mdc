---
alwaysApply: false
---
# Cursor AI Rule: Embedded C Call Graph Generator

## Purpose
Generate Mermaid flowchart diagrams showing function call relationships across C files for embedded systems.

## Core Requirements (MUST FOLLOW)

### 1. File Structure - Show Functions in Each File
Each .c file MUST be a subgraph containing all relevant functions:
```
subgraph FILENAME["filename.c"]
    direction TB
    func1[function1]
    func2[function2]
    func3[function3]
end
```

### 2. Function Details - Brief Description + Call Chain
Each function MUST show:
- Function name
- Brief description (what it does)
- Formatted with separator line

```
func["function_name()<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>Brief description of what it does"]
```

### 3. Consistent Color Per Call Chain
Functions in the same call chain MUST have the same color:
- Define one style per call chain
- Apply consistently to all functions in that chain

## Input Format Required

When user provides code, ask for:

**1. Files and their functions:**
```
File: filename.c
Functions: function_name(), another_function()

File: other_file.c  
Functions: isr_handler()
```

**2. Call chains:**
```
function_name() -> isr_handler()
another_function() -> isr_handler()
```

**3. Function descriptions (optional):**
```
function_name(): Initializes the watchdog timer
isr_handler(): Handles timer interrupt
```

## Output Format

```mermaid
flowchart LR
    subgraph file1["filename.c"]
        direction TB
        func1["function_name()<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>Initializes watchdog timer"]
        func2["another_function()<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>Processes sensor data"]
    end
    
    subgraph file2["other_file.c"]
        direction TB
        func3["isr_handler()<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>âš¡ Handles timer interrupt"]
    end
    
    func1 --> func3
    func2 --> func3
    
    %% Define styles - one per call chain
    classDef chain1 fill:#ffcccc,stroke:#cc0000,stroke-width:2px
    classDef chain2 fill:#ccddff,stroke:#0066cc,stroke-width:2px
    
    %% Apply styles consistently per chain
    class func1,func3 chain1
    class func2 chain2
```

## Styling Rules

**Color Assignment:**
- **Chain 1** (Critical/Init): Red (`fill:#ffcccc,stroke:#cc0000`)
- **Chain 2** (Normal/Process): Blue (`fill:#ccddff,stroke:#0066cc`)
- **Chain 3** (Periodic): Green (`fill:#ccffcc,stroke:#00cc00`)
- **Chain 4** (Error/Handler): Orange (`fill:#ffddaa,stroke:#ff8800`)
- **Chain 5** (Optional): Gray (`fill:#f0f0f0,stroke:#666666`)

**Apply same style to ALL functions in a call chain** - from caller to final callee.

## Arrow Styling

- Normal calls: `-->`
- Optional calls: `-.->` (dotted)
- Critical calls: `==>` (thick)
- Add timing labels when relevant: `-->|every 100ms|`

## Additional Annotations (Optional)

Only add these emojis when specifically relevant:
- âš¡ ISR/Interrupt context
- âš ï¸ Critical/time-sensitive
- â±ï¸ Timing requirement
- ðŸ”§ Hardware access

## Example Workflow

**User provides:**
```
Files:
- main.c: main(), init_system()
- driver.c: driver_init(), driver_read()

Call chains:
- main() -> init_system() -> driver_init()
- main() -> driver_read()

Descriptions:
- main(): Entry point
- init_system(): Initialize all peripherals
- driver_init(): Configure driver hardware
- driver_read(): Read sensor data
```

**AI generates:**
```mermaid
flowchart LR
    subgraph main["main.c"]
        direction TB
        main_func["main()<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>Entry point"]
        init_sys["init_system()<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>Initialize all peripherals"]
    end
    
    subgraph driver["driver.c"]
        direction TB
        drv_init["driver_init()<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>Configure driver hardware"]
        drv_read["driver_read()<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>Read sensor data"]
    end
    
    main_func --> init_sys
    init_sys --> drv_init
    main_func --> drv_read
    
    %% Chain 1: Initialization (red)
    classDef chain1 fill:#ffcccc,stroke:#cc0000,stroke-width:2px
    class main_func,init_sys,drv_init chain1
    
    %% Chain 2: Normal operation (blue)
    classDef chain2 fill:#ccddff,stroke:#0066cc,stroke-width:2px
    class drv_read chain2
```

## Key Points

1. **Every function in the same call path gets the same color**
2. **Keep descriptions brief** (one line per function)
3. **Always use subgraphs** for files
4. **Always use the separator line** `â”€â”€â”€â”€â”€â”€â”€â”€` in function descriptions
5. **Ask user for files, functions, and call chains** if not provided